#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int i = 0;

struct action {
   // what this looks like on the stack:
   // 7 bytes of user input
   // 1 null byte
   // 5 bytes of user input
   // 1 null byte

   char activity[8];
   char room[5];
   char www;
};

void flush(void) {
    int ch;
    while ((ch = getchar()) && ch != EOF && ch != '\n'){}
}

void menu_loop() {
    struct action log[8] = {};

    //for (int i = 0; ; i++) {
    // take the loop counter / array index off the stack
    // and make it global instead
    // we're not generous enough to give them an arbitrary write
    for (i = 0; ; i++) {
        log[i].www = 0;

        printf("\n");
        printf("[A]ction\n");
        printf("[S]how activity log\n");
        printf("[Q]uit\n");
        printf("\n");
        printf("Enter your choice, (or press enter to refresh): ");

        char ch = getchar();

        switch (ch) {
            case EOF:
            case 'q':
            case 'Q':
                return;

            case 'A':
            case 'a':
                flush();

                printf("Enter room name (max 5 chars): ");
                fgets(log[i].room, 6, stdin); //read in 5 bytes, append null byte
                flush();


                printf("Enter activity (max 7 chars): ");
                fgets(log[i].activity, 8, stdin); //read in 7 bytes, append null byte
                flush();

                break;

            case 'S':
            case 's':
                flush();
                puts("sorry i was too lazy to implement this lmfao");
                break;

            default:
                flush();
                printf("\n");
                break;
        }
    }
}

int main(void) {
    setbuf(stdout, NULL);

    char name[20];
    printf("What's your name?\nName: ");
    fgets(name, 22, stdin);
    printf("\nHi %s! Welcome to the isolation minigame (v1.0).\n"
          "It's not quite finished, so you'll have to choose your own adventure for now.\n", name);
    puts("-------------------------------------------------------");
    puts("You are stuck in your house. What will you do next?");

    menu_loop();
}
